{% extends 'main/base_emp.html'%}
{% block title %} Inventory Report {% endblock %}
{% block content %}

<h3 class="text-3xl font-semibold mb-6">Inventory Report</h3>

<form method="get" class="flex flex-wrap gap-2 items-center mb-4">
  <input type="search" name="search" value="{{ request.GET.search }}" placeholder="Search by SKU or name..."
         class="py-2 px-2 border border-gray-300 rounded-full" />
  <input type="date" name="start" value="{{ request.GET.start }}" class="py-2 px-2 border border-gray-300 rounded-full" />
  <input type="date" name="end"   value="{{ request.GET.end }}"   class="py-2 px-2 border border-gray-300 rounded-full" />
  <select name="order_by" class="px-4 py-2 text-sm bg-[--jaffa-30] rounded-full">
    <option value="">Order By</option>
    <option value="current" {% if request.GET.order_by == 'current' %}selected{% endif %}>Current Stock</option>
    <option value="in"      {% if request.GET.order_by == 'in' %}selected{% endif %}>IN Qty</option>
    <option value="out"     {% if request.GET.order_by == 'out' %}selected{% endif %}>OUT Qty</option>
    <option value="net"     {% if request.GET.order_by == 'net' %}selected{% endif %}>Net Movement</option>
  </select>
  <button class="px-5 py-2.5 bg-[--jaffa-90] text-white rounded-full">Apply</button>
</form>

<div class="mb-6 p-4 bg-white border rounded-lg">
  <div class="text-sm text-gray-500">Total Products</div>
  <div class="text-3xl font-semibold text-gray-900">{{ total_products }}</div>
</div>

<div class="relative overflow-x-auto border rounded-lg">
  <table class="w-full text-sm text-left text-gray-500">
    <thead class="text-xs text-gray-700 uppercase bg-gray-100">
      <tr>
        <th class="px-6 py-3">SKU</th>
        <th class="px-6 py-3">Name</th>
        <th class="px-6 py-3">Category</th>
        <th class="px-6 py-3">Current</th>
        <th class="px-6 py-3">IN</th>
        <th class="px-6 py-3">OUT</th>
        <th class="px-6 py-3">Net</th>
        <th class="px-6 py-3">Status</th>
      </tr>
    </thead>
    <tbody>
      {% for p in products %}
      <tr class="bg-white border-b hover:bg-gray-50">
        <td class="px-6 py-3">{{ p.sku }}</td>
        <td class="px-6 py-3">{{ p.name }}</td>
        <td class="px-6 py-3">{{ p.category.name }}</td>
        <td class="px-6 py-3">{{ p.current_stock }}</td>
        <td class="px-6 py-3">{{ p.in_qty }}</td>
        <td class="px-6 py-3">{{ p.out_qty }}</td>
        <td class="px-6 py-3">{{ p.net_movement }}</td>
        <td class="px-6 py-3">
          {% if p.current_stock < p.reorder_level or p.current_stock == None %}
            <span class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full">LOW</span>
          {% else %}
            <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">OK</span>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="8" class="px-6 py-6 text-center text-gray-500">No data.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- pagination -->
        <nav class="m-2 flex items-center flex-column flex-wrap md:flex-row justify-between pt-4" aria-label="Table navigation">
            <span class="text-sm font-normal text-gray-500 mb-4 md:mb-0 block w-full md:inline md:w-auto">
                Showing <span class="font-semibold text-gray-900">{{ products.number }}</span> of 
                <span class="font-semibold text-gray-900">{{ products.paginator.num_pages }}</span>
            </span>
            <ul class="inline-flex -space-x-px rtl:space-x-reverse text-sm h-8">
                <!-- Previous -->
                {% if products.has_previous %}
                    <li><a href="?page=1" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700">First</a></li>
                    <li><a href="?page={{ products.previous_page_number }}" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700">Previous</a></li>
                {% endif %}

                <!-- Page Numbers -->
                {% for num in products.paginator.page_range %}
                    {% if products.number == num %}
                        <li><span class="flex items-center justify-center px-3 h-8 text-gray-900 border border-gray-300 bg-gray-50">{{ num }}</span></li>
                    {% else %}
                        <li><a href="?page={{ num }}" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700">{{ num }}</a></li>
                    {% endif %}
                {% endfor %}
                <!-- Next -->
                {% if products.has_next %}
                    <li><a href="?page={{ products.next_page_number }}" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700">Next</a> </li>
                    <li><a href="?page={{ products.paginator.num_pages }}" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700">Last</a> </li>
                {% endif %}
            </ul>
        </nav>
{% endblock %}
